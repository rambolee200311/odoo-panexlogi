<odoo>
    <data>
        <record id="email_template_delivery_quote" model="mail.template">
            <field name="body_html" type="html">
                <div>
                    <p>Dear <t t-out="receiver_name or 'Valued Partner'"/></p>
                    <p><t t-out="quote_content or ''"/></p>
                    <p>Reference No:<t t-out="billno"/></p>
                    <p>Type:<t t-out="delivery_type"/></p>

                    <!-- 全局分组计数器 -->
                    <t t-set="group_counter" t-value="{'value': 1}"/>

                    <t t-foreach="grouped_requests" t-as="group">
                        <t t-if="group and group[0]">
                            <div style="margin: 20px 0; padding: 15px; border: 1px solid #eee;">
                                <h3>#<t t-esc="group_counter['value']"/></h3>

                                <!-- 地址信息 -->
                                <div style="margin: 10px 0;">
                                    <p>Load Address:
                                        <t t-out="(group[0].load_address.street or '') + ', ' +
                                            (group[0].load_address.city or '') if group[0].load_address
                                            else 'Not specified'"/>
                                    </p>
                                    <p>Unload Address:
                                        <t t-out="(group[0].unload_address.street or '') + ', ' +
                                            (group[0].unload_address.city or '') if group[0].unload_address
                                            else 'Not specified'"/>
                                    </p>
                                </div>

                                <!-- 项目表格 -->
                                <table border="1" cellpadding="5" style="width:100%">
                                    <thead>
                                        <tr>
                                            <th>Seq</th>
                                            <th>Product</th>
                                            <th>Pallets</th>
                                            <th>Pcs</th>
                                            <th>Gross Weight</th>
                                            <th>ADR</th>
                                            <th>stackable</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- 项目计数器 -->
                                        <t t-set="item_counter" t-value="{'value': 1}"/>

                                        <t t-foreach="group" t-as="line">
                                            <tr>
                                                <td><t t-esc="item_counter['value']"/></td>
                                                <td><t t-out="line.product.name"/></td>
                                                <td><t t-out="line.pallets"/></td>
                                                <td><t t-out="line.qty"/></td>
                                                <td><t t-out="line.gross_weight"/> kg</td>
                                                <td><t t-out="line.adr if line.adr else 'False'"/></td>
                                                <td><t t-out="line.stackable if line.stackable else 'False'"/></td>
                                            </tr>
                                            <t t-set="item_counter" t-value="{'value': item_counter['value'] + 1}"/>
                                        </t>
                                    </tbody>
                                </table>
                            </div>

                            <!-- 更新分组计数器 -->
                            <t t-set="group_counter" t-value="{'value': group_counter['value'] + 1}"/>
                        </t>
                    </t>
                </div>
            </field>
        </record>
    </data>
</odoo>